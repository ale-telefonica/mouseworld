nsd:
  nsd:
  - id: {{ name }}_ns
    name: {{ name }}_ns
    designer: Mouseworld
    description: Generated by Mouseworld package generator
    version: '1.0'
    vnfd-id:
    {% for vnf in vnfs %}
    {%if loop.nextitem == vnf %}
    {% else %}
    - {{ vnf.id }}_vnf
    {%endif%}
    {%endfor%}
    df:
    - id: default-df
      vnf-profile:
      {% for vnf in vnfs %}
      {% set index = loop.index %}
      - id: "{{index}}"
        vnfd-id: {{ vnf.id }}_vnf
        virtual-link-connectivity:
        {% for network in vnf.external_networks %}
        - virtual-link-profile-id: {{ network }}
          constituent-cpd-id:
          {% for cp in vnf.cps %}
          {% if network in cp.id %}
          - constituent-base-element-id: "{{index}}"
            constituent-cpd-id: {{cp.id}}
          {%endif%}
          {%endfor%}
        {%endfor%}
      {%endfor%}
    virtual-link-desc:
    {% for network in external_networks %}
    - id: {{network}}
    {% if network == "management_network" %}
      mgmt-network: true
    {%endif%}
    {%endfor%}

